<!DOCTYPE html>







<html lang="en" 
  
    mode="light"
  
>

  <!--
  The Head
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  

    <!-- i18n for `_javascript/utils/timeago.js` -->
    <meta name="day-prompt" content="days ago">
    <meta name="hour-prompt" content="hours ago">
    <meta name="minute-prompt" content="minutes ago">
    <meta name="justnow-prompt" content="just now">

    

    

  

  <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Gaussian Label Smoothing" />
<meta name="author" content="Haytham ElFadeel" />
<meta property="og:locale" content="en" />
<meta name="description" content="The generalization of neural networks can often be improved by using label smoothing which is soft targets that are a weighted average of the hard targets and the uniform distribution over labels. We introduce a new variation of label smoothing that improve the performance of sequence-based models such as BERT, ELMo" />
<meta property="og:description" content="The generalization of neural networks can often be improved by using label smoothing which is soft targets that are a weighted average of the hard targets and the uniform distribution over labels. We introduce a new variation of label smoothing that improve the performance of sequence-based models such as BERT, ELMo" />
<link rel="canonical" href="https://hfadeel.github.io//posts/gls/" />
<meta property="og:url" content="https://hfadeel.github.io//posts/gls/" />
<meta property="og:site_name" content="Haytham ElFadeel" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-12-10T19:32:00-07:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Gaussian Label Smoothing" />
<meta name="google-site-verification" content="google_meta_tag_verification" />
<script type="application/ld+json">
{"mainEntityOfPage":{"@type":"WebPage","@id":"https://hfadeel.github.io//posts/gls/"},"@type":"BlogPosting","url":"https://hfadeel.github.io//posts/gls/","headline":"Gaussian Label Smoothing","dateModified":"2018-12-10T19:32:00-07:00","datePublished":"2018-12-10T19:32:00-07:00","author":{"@type":"Person","name":"Haytham ElFadeel"},"description":"The generalization of neural networks can often be improved by using label smoothing which is soft targets that are a weighted average of the hard targets and the uniform distribution over labels. We introduce a new variation of label smoothing that improve the performance of sequence-based models such as BERT, ELMo","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->


  <title>Gaussian Label Smoothing | Haytham ElFadeel
  </title>

  <!--
  The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps
  Generated by: https://realfavicongenerator.net/
-->



<link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png">
<link rel="manifest" href="/assets/img/favicons/site.webmanifest">
<link rel="shortcut icon" href="/assets/img/favicons/favicon.ico">
<meta name="apple-mobile-web-app-title" content="Haytham ElFadeel">
<meta name="application-name" content="Haytham ElFadeel">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link rel="dns-prefetch" href="https://fonts.gstatic.com">

  <!-- GA -->
<!--  -->

  <!-- jsDelivr CDN -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css">

  <!--
  CSS selector for site.
-->

<link rel="stylesheet" href="/assets/css/style.css">


  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css">



  <!-- Manific Popup -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css">



  <!-- JavaScript -->

  <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>

</head>


  <body data-spy="scroll" data-target="#toc">

    <!--
  The Side Bar
-->

<div id="sidebar" class="d-flex flex-column align-items-end" lang="en">
  <div class="profile-wrapper text-center">
    <div id="avatar">
      <a href="/" alt="avatar" class="mx-auto">
        
        <img src="/assets/img/favicons/android-chrome-512x512.png" alt="avatar" onerror="this.style.display='none'">
      </a>
    </div>

    <div class="site-title mt-3">
      <a href="/">Haytham ElFadeel</a>
    </div>
    <div class="site-subtitle font-italic"></div>

  </div><!-- .profile-wrapper -->

  <ul class="w-100">

    <!-- home -->
    <li class="nav-item">
      <a href="/" class="nav-link">
        <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i>
        <span>HOME</span>
      </a>
    </li>
    <!-- the real tabs -->
    
    <li class="nav-item">
      <a href="/about/" class="nav-link">
        <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i>
        

        <span>ABOUT</span>
      </a>
    </li> <!-- .nav-item -->
    

  </ul> <!-- ul.nav.flex-column -->

  <div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center">

    
      

      
      <a href="https://www.linkedin.com/in/hfadeel/" aria-label="linkedin"
        
        target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
      

    
      

      
      <a href="
          javascript:location.href = 'mailto:' + ['hfadeelm','gmail.com'].join('@')" aria-label="email"
        
        >
        <i class="fas fa-envelope"></i>
      </a>
      

    
      

      
      <a href="/feed.xml" aria-label="rss"
        
        >
        <i class="fas fa-rss"></i>
      </a>
      

    

    

  </div> <!-- .sidebar-bottom -->

</div><!-- #sidebar -->


    <!--
  The Top Bar
-->

<!--<div id="topbar-wrapper" class="row justify-content-center topbar-down">-->
<!--  <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between">-->
<!--    <span id="breadcrumb">-->

<!--    -->

<!--    -->

<!--      -->

<!--        -->
<!--          <span>-->
<!--            <a href="/">-->
<!--              Home-->
<!--            </a>-->
<!--          </span>-->

<!--        -->

<!--      -->

<!--        -->

<!--      -->

<!--        -->

<!--          -->
<!--            <span>Gaussian Label Smoothing</span>-->
<!--          -->

<!--        -->

<!--      -->

<!--    -->

<!--    </span>&lt;!&ndash; endof #breadcrumb &ndash;&gt;-->

<!--    <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i>-->

<!--    <div id="topbar-title">-->
<!--      -->
<!--Post-->
<!--      -->
<!--    </div>-->

<!--    <i id="search-trigger" class="fas fa-search fa-fw"></i>-->
<!--    <span id="search-wrapper" class="align-items-center">-->
<!--      <i class="fas fa-search fa-fw"></i>-->
<!--      <input class="form-control" id="search-input" type="search"-->
<!--        aria-label="search" autocomplete="off" placeholder="Search...">-->
<!--      <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i>-->
<!--    </span>-->
<!--    <span id="search-cancel" >Cancel</span>-->
<!--  </div>-->

<!--</div>-->


    <div id="main-wrapper">
      <div id="main">

        <!--
  Refactor the HTML structure.
-->



<!--
  In order to allow a wide table to scroll horizontally,
  we suround the markdown table with `<div class="table-wrapper">` and `</div>`
-->



<!--
  Fixed kramdown code highlight rendering:
  https://github.com/penibelst/jekyll-compress-html/issues/101
  https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901
-->



<!-- Add attribute 'hide-bullet' to the checkbox list -->




<!-- images -->



  <!-- add CDN prefix if it exists -->

  

  

  <!-- lazy-load images <https://github.com/ApoorvSaxena/lozad.js#usage> -->

  

  <!-- add image placehoder to prevent layout reflow -->

  

  

  
    
      
      
    

    
    
    

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    
      
      

      

      

    

    

  

  



<!-- Add lang-badge for code snippets -->




<!-- return -->





<div class="row">

  <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">

    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">

      <h1 data-toc-skip>Gaussian Label Smoothing</h1>

      <div class="post-meta text-muted d-flex flex-column">
        <!-- Published date and author -->
        <div>
          <span class="semi-bold">
            Haytham ElFadeel
          </span>
          
          <!--
  Date format snippet
  See: /assets/js/_utils/timeage.js
-->






  on

<span class="timeago "
  
    data-toggle="tooltip"
    data-placement="bottom"
    title="Mon, Dec 10, 2018,  7:32 PM -0700"
  >Dec 10, 2018<i class="unloaded">2018-12-10T19:32:00-07:00</i>
</span>

        </div>

        <div>
          <!-- lastmod -->
          

          <!-- read time -->
          <!--
  Calculate the post's reading time, and display the word count in tooltip
 -->



<!-- words per minute  -->










<!-- return element -->
<!--<span class="readtime" data-toggle="tooltip" data-placement="bottom"-->
<!--  title="863 words">-->
<!--4 min-->
<!---->
<!--     read-->
<!---->
<!--</span>-->


          <!-- page views -->
          

        </div>

      </div> <!-- .post-meta -->

      <div class="post-content">

        

        <p>The generalization of neural networks can often be improved by using label smoothing which is soft targets that are a weighted average of the hard targets and the uniform distribution over labels. We introduce a new variation of label smoothing that improve the performance of sequence-based models such as BERT, ELMo</p>

<h2 id="introduction">Introduction:</h2>

<p>Neural Networks (NNs) have proved their efficiency in solving classification problems in areas. Szegedy et al. introduced label smoothing, which improves accuracy by computing cross entropy not with the ‘hard’ targets from the dataset, but with a weighted mixture of these targets with the uniform distribution. Label smoothing has been used successfully to improve the accuracy of deep learning models in many tasks, such as image classification, speech recognition, and machine translation.</p>

<p>The goal of Label smoothing is to prevent the largest logit from becoming much larger than all others, thus encouraging uncertainty in the labels of a dataset. This uncertainty helps to tackle the over-fitting issue, and thus LS can be an efficient method to address the adversarial attack phenomenon.</p>

<p>Hinton et al. introduced a knowledge distillation approach, which improves accuracy by training a few big models (teachers), then training a student model with a mixture of the targets with the teacher ensemble output. Knowledge distillation has been used successfully to improve the accuracy of deep learning models and in distilling knowledge from large models to smaller models.</p>

<p>Knowledge distillation goal is to enrich the limited knowledge present in the sparse targets by including the knowledge from the ensemble models’ output. KD works because most of the knowledge in the learned ensemble is in the relative probabilities of extremely improbable wrong answers. For example, the ensemble may give a BMW a probability of one in a billion of being a garbage truck but this is still far greater (in the log domain) than its probability of being a carrot.</p>

<h2 id="gaussian-label-smoothing">Gaussian Label Smoothing:</h2>

<p>The inspiration of GLS came from the realization that in sequence tagging problems (such as named entity recognition, question answering and Semantic Role labeling) the relative probability of two consecutive tokens labels is related. Unlike typical classification problems where two consecutive labels are not related. In languages consecutive tokens are related.</p>

<p>For example, Given this question ‘<strong><em>When did Beyonce start becoming popular</em></strong>’ and the context ‘<strong><em>Beyoncé was born and raised in Houston, Texas, she performed in various singing and dancing competitions as a child, and rose to fame in the late 1990s as lead singer of R&amp;B girl-group Destiny’s Child</em></strong>’ the correct answer is <strong><em>’late 1990s</em></strong>’ but the probability of the span ‘<strong>in the late 1990s</strong>’ being an answer should be higher than any other random token span.</p>

<p>GLS takes into account the fact that sequence of tokens is related and instead of the uniform distribution over the label that label smoothing proposes we adjust it to also include gaussian distribution around the correct token. See figure 1</p>

<p><img data-proofer-ignore data-src="/assets/img/blog/gls_1.png" alt="Desktop View" title="image_tooltip" /></p>

<p>Figure 1 - 1st, the original target labels, 2nd Label Smoothing with smoothing set to 0.05, 3rd is Gaussian Label Smoothing with smoothing set to 0.05</p>

<h2 id="the-relationship-to-knowledge-distillation">The relationship to Knowledge Distillation</h2>

<p>We predicted that the error of the ensemble of large models that trained and regularized well will tend to be missing the correct token by one or a few tokens. That is why in general the F1 score of the SQUAD problem is higher than the exact match.</p>

<p>After careful analysis of model errors, it turns out that this assumption is true. A small mistake in the boundary is one of the big types of errors. Thus, Gaussian Label Smoothing bears some of the knowledge distillation characteristic in the case of sequence tagging where the sequence tokens are related.</p>

<h2 id="experiments">Experiments</h2>

<p>We experimented with BERT Base on named entity recognition and BERT large on questions answering SQUAD 2.0.</p>

<p>We compared our standard implementation with a label smoothing and a gaussian label smoothing variance. After reproducing the paper results. All hyperparameters were fixed.</p>

<div class="table-wrapper"><table>
  <tr>
   <td>
    <strong>System</strong>
   </td>
   <td>
    <strong>Dev F1</strong>
   </td>
   <td>
    <strong>Test F1</strong>
   </td>
  </tr>
  <tr>
   <td>
    BERT <sup>BASE</sup> (paper)
   </td>
   <td>
    96.4
   </td>
   <td>
    92.4
   </td>
  </tr>
  <tr>
   <td>
    BERT <sup>BASE</sup> (our-implementation)
   </td>
   <td>
    96.4
   </td>
   <td>
    92.4
   </td>
  </tr>
  <tr>
   <td>
    BERT <sup>BASE</sup> + LS
   </td>
   <td>
    96.4
   </td>
   <td>
    92.4
   </td>
  </tr>
  <tr>
   <td>
    BERT <sup>BASE</sup> + GLS
   </td>
   <td>
    96.5
   </td>
   <td>
    92.6
   </td>
  </tr>
  <tr>
   <td colspan="3">
    CoNLL-2003 Named Entity Recognition results
   </td>
  </tr>
</table></div>

<p>For named entity recognition we used the CoNLL-2003 dataset.</p>

<p>For SQUAD 2.0, we trained the model for 3 epochs, while decreasing the learning rate at the start of each epoch. We used Adam optimizer with 200 warm-up steps where the larging rate ramped up to the desired value. Table 2 contains the results.</p>

<h3 id="update-nov-2019">Update Nov 2019</h3>

<p>We applied LB and GLS to ALBERT XLARGE model on SQUAD 2.0 dataset. Table 3 shows the results.</p>

<hr />

<div class="table-wrapper"><table>
  <tr>
   <td><strong>System</strong>
   </td>
   <td><strong>Dev F1</strong>
   </td>
   <td><strong>Dev EM</strong>
   </td>
  </tr>
  <tr>
   <td>BERT <sup>LARGE</sup> (our-implementation)
   </td>
   <td>84.1
   </td>
   <td>81.0
   </td>
  </tr>
  <tr>
   <td>BERT <sup>LARGE</sup> + LS
   </td>
   <td>84.2
   </td>
   <td>81.1
   </td>
  </tr>
  <tr>
   <td>BERT <sup>LARGE</sup> + GLS
   </td>
   <td>84.9
   </td>
   <td>81.4
   </td>
  </tr>
  <tr>
   <td colspan="3">BERT <sup>Large</sup>  SQUAD 2.0 Dev results
   </td>
  </tr>
</table></div>

<div class="table-wrapper"><table>
  <tr>
   <td><strong>System</strong>
   </td>
   <td><strong>Dev F1</strong>
   </td>
   <td><strong>Dev EM</strong>
   </td>
  </tr>
  <tr>
   <td>ALBERT <sup>XLARGE</sup> (our-implementation)
   </td>
   <td>87.9
   </td>
   <td>84.1
   </td>
  </tr>
  <tr>
   <td>ALBERT <sup>XLARGE</sup> + LS
   </td>
   <td>88.05
   </td>
   <td>84.5
   </td>
  </tr>
  <tr>
   <td>ALBERT <sup>XLARGE</sup> + GLS
   </td>
   <td>88.21
   </td>
   <td>85.2
   </td>
  </tr>
  <tr>
   <td colspan="3">ALBERT <sup>XLarge</sup> SQUAD 2.0 Dev results
   </td>
  </tr>
</table></div>

<h2 id="conclusion">Conclusion</h2>

<p>Label smoothing is used to train many state-of-the-art models. In this work, we proposed a variant that is well suited for sequence tagging problems by taking into account the nature. We performed experiments to evaluate and compare the new variant with the standard label smoothing.</p>



      </div>

      <div class="post-tail-wrapper text-muted">

        <!-- categories -->
<!--        -->

        <!-- tags -->
<!--        -->

        <div class="post-tail-bottom
          d-flex justify-content-between align-items-center mt-3 pt-5 pb-2">
          <div class="license-wrapper">
<!--          -->
<!--            -->
<!--            This post is licensed under -->
<!--            <a href="https://creativecommons.org/licenses/by/4.0/">-->
<!--              CC BY 4.0-->
<!--            </a>-->
<!--             by the author.-->
<!--          -->
          </div>

          <!--
 Post sharing snippet
-->

<div class="share-wrapper">
  <span class="share-label text-muted mr-1">Share</span>
  <span class="share-icons">
    
    

    
      
        <a href="https://www.linkedin.com/sharing/share-offsite/?url=https://hfadeel.github.io//posts/gls/" data-toggle="tooltip" data-placement="top"
          title="LinkedIn" target="_blank" rel="noopener" aria-label="LinkedIn">
          <i class="fa-fw fab fa-linkedin"></i>
        </a>
    

    <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')"
        data-toggle="tooltip" data-placement="top"
        title="Copy link">
    </i>

  </span>
</div>


        </div><!-- .post-tail-bottom -->

      </div><!-- div.post-tail -->

    </div> <!-- .post -->


  </div> <!-- #post-wrapper -->

  

  

  <!--
  The Pannel on right side (Desktop views)
-->





<div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">

  <div class="access">

  














  

  

















  
  </div> <!-- .access -->

  
    <!-- BS-toc.js will be loaded at medium priority -->
    <script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script>
    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
      <span class="pl-3 pt-2 mb-2">Contents</span>
      <nav id="toc" data-toggle="toc"></nav>
    </div>
  

</div> <!-- #panel-wrapper -->


</div> <!-- .row -->

<div class="row">
  <div class="col-12 col-lg-11 col-xl-8">
    <div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">




    </div> <!-- #post-extend-wrapper -->

  </div> <!-- .col-* -->

</div> <!-- .row -->



        <!--
  The Footer
-->

<footer class="d-flex w-100 justify-content-center">
  <div class="d-flex justify-content-between align-items-center">
    <div class="footer-left">
      <p class="mb-0">
        © 2021
        <a href="">Haytham ElFadeel</a>.
        
        <span data-toggle="tooltip" data-placement="top"
          title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span>
        
      </p>
    </div>

    <div class="footer-right">
      <p class="mb-0">
        

        

        Powered by 
          <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>
         with 
          <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a>
         theme.

      </p>
    </div>

  </div> <!-- div.d-flex -->
</footer>


      </div>

      <!--
  The Search results
-->
<div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
  <div class="col-12 col-sm-11 post-content">
    <div id="search-hints">
      <h4 class="text-muted mb-4">Trending Tags</h4>

      

















      

    </div>
    <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
  </div>
</div>


    </div> <!-- #main-wrapper -->

    

    <div id="mask"></div>

    <a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button">
      <i class="fas fa-angle-up"></i>
    </a>

    <!--
  Jekyll Simple Search loader
  See: <https://github.com/christian-fei/Simple-Jekyll-Search>
-->





<script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>

<script>
SimpleJekyllSearch({
  searchInput: document.getElementById('search-input'),
  resultsContainer: document.getElementById('search-results'),
  json: '/assets/js/data/search.json',
  searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0">  <a href="https://hfadeel.github.io/{url}">{title}</a>  <div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1">    {categories}    {tags}  </div>  <p>{snippet}</p></div>',
  noResultsText: '<p class="mt-5">Oops! No result founds.</p>',
  templateMiddleware: function(prop, value, template) {
    if (prop === 'categories') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`;
      }
    }

    if (prop === 'tags') {
      if (value === '') {
        return `${value}`;
      } else {
        return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`;
      }
    }
  }
});
</script>


    <!--
  JS selector for site.
-->

<!-- layout specified -->


  



  <!-- image lazy-loading & popup -->
  <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script>





<script defer src="/assets/js/dist/post.min.js"></script>



<!-- commons -->

<script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script>




  </body>

</html>

